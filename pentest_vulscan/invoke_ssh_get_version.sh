#!/bin/bash
# 
# Script to determine the SSH protocol version via one of the following methods:
#     metasploit framework
# 

if [ $# -lt 1 ]; then
    echo "[-] cat ...<target|port|proto>... | $0 run [method=msfconsole]"
    exit 1
fi
method=${2:-"msfconsole"}

# Get list of target/port/protocol from user
combos=$(cat -)

# Script directory
script_dir=$(dirname "$0")

# Loop through each combination and identify all SSH hosts
IFS=$'\n'
for combo in $combos; do
    if [ ! -z "$combo" ]; then
        if [ "$method" == "msfconsole" ]; then
            echo "$combo" | \
                $script_dir/invoke_cmd_on_target.sh "msfconsole -q -x \
\"use scanner/ssh/ssh_version; set RHOSTS TARGET; set RPORT PORT; run; exit;\""
        fi
    fi
done