#!/bin/bash
#
# Get a part from  target, port and protocol
#
DELIM="|"

if [ $# -lt 1 ]; then
    echo "[-] ...<target|port|protocol>... | $0 <part='target'|'port'|'protocol'\
/'proto'|'uri'|'all'> [default='']"
    exit 1
fi
part_to_get="$1"
default="$2"

combos=$(cat -)

# Loop through the target|port|protcol list
IFS=$'\n'
for combo in $combos; do
    if [ ! -z "$combo" ]; then
        # Get the individual components 
        contains_delim=$(echo "$combo" | grep -i "$DELIM")
        if [ ! -z "$contains_delim" ]; then
            target=$(echo "$combo" | cut -f1 -d"$DELIM")

            port=$(echo "$combo" | cut -f2 -d"$DELIM")
            [ -z "$port" ] && port="$default"

            protocol=$(echo "$combo" | cut -f3 -d"$DELIM")
            [ -z "$protocol" ] && port="$default"
        else
            target="$combo"
            port="$default"
            protocol="$default"
        fi

        # Display the url part requested 
        if [ "$part_to_get" == "target" ]; then
            echo "$target"
        elif [ "$part_to_get" == "port" ]; then
            echo "$port"
        elif [ "$part_to_get" == "protocol" ] || [ "$part_to_get" == "proto" ]; then
            echo "$protocol"
        elif [ "$part_to_get" == "uri" ]; then
            echo "$protocol://$target:$port"
        elif [ "$part_to_get" == "all" ]; then
            echo "$target$DELIM$port$DELIM$protocol"
        else
            echo "[-] Unknown part_to_get: $part_to_get"
        fi
    fi
done


