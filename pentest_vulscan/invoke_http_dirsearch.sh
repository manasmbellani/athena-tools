#!/bin/bash
#
# Script determines the HTTP paths for a given URL list using a variety of tools
#
#

# User agent string
USER_AGENT="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.163 Safari/537.36"

if [ $# -lt 1 ]; then
    echo "[-] cat ...<target|port|proto>... | $0 run [method=dirsearch|all] \
[recursive=1] [outfile-prefix=out-dirsearch]"
    exit 1
fi
method=${2:-"all"}
recursive=${3:-"1"}
outfile_prefix=${4:-""}

# Get list of target/port/protocol from user
combos=$(cat -)

# Script directory
script_dir=$(dirname "$0")

# Loop through each combination and identify all SSH hosts
IFS=$'\n'
for combo in $combos; do
    if [ ! -z "$combo" ]; then
        if [ "$method" == "dirsearch" ]; then
            echo "$combo" | \
                $script_dir/invoke_cmd_on_target.sh "python3 \
/opt/dirsearch/dirsearch.py -x 400,401,403 -r -R5 -u https://TARGET:PORT -E \
--ua \"$USER_AGENT\" --plain-text-report /tmp/out-dirsearch-TARGET-PORT.txt"
        fi
    fi
done
