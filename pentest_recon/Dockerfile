FROM kalilinux/kali-rolling
MAINTAINER manasbellani
WORKDIR /opt/athena-tools

# Install all the apt-gettable modules one-by-one
# Not installed packages:
#   psmisc, for  using killall
#   unixodbc-dev, for using changeme
#   libpq-dev, for using changeme
#   golang, for installing shuffledns/gobuster
#   net-tools, for installing ifconfig
#   expect, to use unbuffer command for theHarvester to write output
#   chromium browser, for installing aquatone and taking screenshots
RUN apt-get -y update && apt-get install -y \
    build-essential \
    gcc \
    curl \
    make \
    sudo \
    dnsrecon \
    git \
    iputils-ping \
    dnsutils \
    vim \
    bash \
    sqlite3 \
    nmap \
    python \
    python3 \
    python3-pip \
    ftp \
    amass \
    whois \
    psmisc \
    procps \
    netcat-traditional \
    default-mysql-client \
    whatweb \
    wget \
    dirb \
    automake \
    libtool \
    man-db \
    apt-utils \
    golang \
    net-tools \
    expect \
    chromium \
    parallel \
    fierce

# Install python-pip module
RUN curl -s https://bootstrap.pypa.io/get-pip.py -o get-pip.py && \
    python get-pip.py && \ 
    rm get-pip.py

# Install knockpy
RUN git clone https://github.com/guelfoweb/knock /opt/knock && \
    cd /opt/knock && \
    python -m pip install dnspython && \
    python -m pip install -r requirements.txt && \
    python setup.py install 

# Install theharvester module
RUN git clone https://github.com/laramies/theHarvester /opt/theHarvester && \
    cd /opt/theHarvester && \
    python3 -m pip install -r requirements.txt && \
    python3 setup.py install

# Install pip package to run the engine
RUN python3 -m pip install requests colorlog

# Install crt.sh for cert transparency download
#RUN mkdir /opt/crt.sh && \ 
#    curl -s https://gist.githubusercontent.com/manasmbellani/4b4d13a2b630ea2c57fba491a079a4fc/raw/d6308a3fc419834a760d489b74da7df88757147d/recon_info_crtsh.py -o /opt/crt.sh/crt.sh && \
#    chmod +x /opt/crt.sh/crt.sh

# Download the domain bruteforcing list - sortedcombined-knock-dnsrecon-fierce-reconng
RUN mkdir /opt/sortedcombined-knock-dnsrecon-fierce-reconng && wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/DNS/sortedcombined-knock-dnsrecon-fierce-reconng.txt -O /opt/sortedcombined-knock-dnsrecon-fierce-reconng/sortedcombined-knock-dnsrecon-fierce-reconng.txt

# install gobuster for DNS brute-forcing
RUN go get -u github.com/OJ/gobuster

# Install assetfinder
RUN go get -u github.com/tomnomnom/assetfinder

# Install Brute-force based Cleveridge Scanner and remove the need to clear the screen
RUN git clone https://github.com/Cleveridge/cleveridge-subdomain-scanner /opt/cleveridge-subdomain-scanner && \
    cd /opt/cleveridge-subdomain-scanner && \
    sed -E -ibak "s/os.system\(.*clear//g" cl_subd_scan.py && \
    chmod +x cl_subd_scan.py
 
# Install aquatone - latest release
RUN cd /tmp && \
    wget https://github.com/michenriksen/aquatone/releases/download/v1.7.0/aquatone_linux_amd64_1.7.0.zip && \
    unzip aquatone_linux_amd64_1.7.0.zip && \
    mv aquatone /usr/local/bin/ && \
    rm aquatone_linux_amd64_1.7.0.zip    
 
# Install infoga
RUN git clone https://github.com/m4ll0k/Infoga.git /opt/infoga && \
    cd /opt/infoga && \
    python2 setup.py install

# Install recon-ng
RUN git clone https://github.com/lanmaster53/recon-ng.git /opt/recon-ng

# Install subfinder
RUN cd /tmp && \ 
  wget "https://github.com/projectdiscovery/subfinder/releases/download/v2.3.2/subfinder-linux-amd64.tar" -O "subfinder-linux-amd64.tar" && \
  tar -xzvf subfinder-linux-amd64.tar && \
  subfinder-linux-amd64 /usr/local/bin/subfinder

# Install subbrute
RUN git clone https://github.com/TheRook/subbrute /opt/subbrute

# install masscan on which shuffledns relies on: 
# Taken from: https://imranparay.blogspot.com/2018/08/how-to-install-massdns-on-kali-linux.html
#RUN apt-get -y install libldns-dev && \
#    git clone https://github.com/blechschmidt/massdns.git /opt/massdns && \
#    cd /opt/massdns && \
#    make && \
#    mv bin/massdns /usr/bin/

# Install Sublist3r
#RUN git clone https://github.com/aboul3la/Sublist3r /opt/Sublist3r && \
#    cd /opt/Sublist3r && \
#    python3 -m pip install -r requirements.txt

WORKDIR /opt/athena-tools
